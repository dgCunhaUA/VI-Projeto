<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
			crossorigin="anonymous"
		></script>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="navbar.css" />
		<link rel="stylesheet" href="alojamento.css" />
		<script src="https://d3js.org/d3.v4.js"></script>
	</head>
	<body>
		<nav class="navMenu">
			<a href="/index.html">Home</a>
			<a href="/alojamento.html" class="active">Alojamentos Turísticos</a>
			<a href="/ocupacao.html">Ocupação de Alojamentos Turísticos</a>
			<a href="/turismo.html">Turismo da População Residente</a>
			<a href="/receitas.html">Receitas de Alojamentos Turísticos</a>
			<div id="dot"></div>
		</nav>

		<div class="container">
			<div class="title">
				<h1>
					Capacidade nos alojamentos turísticos: total e por tipo de
					alojamento
				</h1>
			</div>
			<div class="subtitle">
				<h4>
					Onde existem mais e menos hotéis e outros alojamentos
					turísticos?
				</h4>
			</div>
		</div>

		<div class="container">
			<div class="row">
				<div class="col-6">
					<div class="graph container">
						<!-- Create a div where the graph will take place -->
						<div id="groupedbarplot_div"></div>
					</div>
				</div>
				<div class="col-6">
					<div class="graph container">
						<!-- Create a div where the graph will take place -->
						<div id="groupedbarplot_div2"></div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script>
		////////////////////////
		//  GROUPED BAR PLOT
		///////////////////////

		// set the dimensions and margins of the graph
		var margin = { top: 10, right: 30, bottom: 100, left: 50 },
			width = 560 - margin.left - margin.right,
			height = 550 - margin.top - margin.bottom;

		// append the svg object to the body of the page
		var svg = d3
			.select("#groupedbarplot_div")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr(
				"transform",
				"translate(" + margin.left + "," + margin.top + ")"
			);

		// Parse the Data
		d3.csv("files/capacidade_alojamentos.csv", function (data) {
			// List of subgroups = header of the csv files = soil condition here
			var subgroups = data.columns.slice(1);

			// List of groups = species here = value of the first column called group -> I show them on the X axis
			var groups = d3
				.map(data, function (d) {
					return d.group;
				})
				.keys();

			// Add X axis
			var x = d3
				.scaleBand()
				.domain(groups)
				.range([0, width])
				.padding([0.2]);
			var xAxis = svg
				.append("g")
				.attr("transform", "translate(0," + height + ")")
				.call(d3.axisBottom(x).tickSize(0));

			xAxis
				.transition()
				.duration(1000)
				.call(d3.axisBottom(x))
				.selectAll("text")
				.style("text-anchor", "end")
				.attr("dx", "-.8em")
				.attr("dy", ".15em")
				.attr("transform", "rotate(-65)");

			// Add Y axis
			var y = d3
				.scaleLinear()
				.domain([
					0,
					d3.max(data, function (d) {
						if (+d["2020"] > +d["2009"]) return +d["2020"];
						else return +d["2009"];
					}),
				])
				.range([height, 0]);
			var yAxis = svg.append("g").call(d3.axisLeft(y));

			// Another scale for subgroup position?
			var xSubgroup = d3
				.scaleBand()
				.domain(subgroups)
				.range([0, x.bandwidth()])
				.padding([0.05]);

			// color palette = one color per subgroup
			var color = d3
				.scaleOrdinal()
				.domain(subgroups)
				.range(["#ffa500", "#377eb8"]);

			// Show the bars
			svg.append("g")
				.selectAll("g")
				// Enter in data = loop group per group
				.data(data)
				.enter()
				.append("g")
				.attr("transform", function (d) {
					return "translate(" + x(d.group) + ",0)";
				})
				.selectAll("rect")
				.data(function (d) {
					return subgroups.map(function (key) {
						return { key: key, value: d[key] };
					});
				})
				.enter()
				.append("rect")
				.attr("x", function (d) {
					return xSubgroup(d.key);
				})
				.attr("y", function (d) {
					return y(d.value);
				})
				.attr("width", xSubgroup.bandwidth())
				.attr("height", function (d) {
					return height - y(d.value);
				})
				.attr("fill", function (d) {
					return color(d.key);
				});

			// Color scheme legend
			// create a list of keys
			var keys = ["2009", "2020"];

			// Add one dot in the legend for each name.
			var size = 20;
			svg
				.selectAll("mydots")
				.data(keys)
				.enter()
				.append("rect")
				.attr("x", 400)
				.attr("y", function (d, i) {
					return 100 + i * (size + 5);
				}) // 100 is where the first dot appears. 25 is the distance between dots
				.attr("width", size)
				.attr("height", size)
				.style("fill", function (d) {
					return color(d);
				});

			// Add one dot in the legend for each name.
			svg
				.selectAll("mylabels")
				.data(keys)
				.enter()
				.append("text")
				.attr("x", 400 + size * 1.2)
				.attr("y", function (d, i) {
					return 105 + i * (size + 5) + size / 2;
				}) // 100 is where the first dot appears. 25 is the distance between dots
				.style("fill", function (d) {
					return color(d);
				})
				.text(function (d) {
					return d;
				})
				.attr("text-anchor", "left")
				.style("alignment-baseline", "middle");
		});

		//////////////////

		// set the dimensions and margins of the graph
		var margin = { top: 10, right: 30, bottom: 20, left: 50 },
			width = 460 - margin.left - margin.right,
			height = 400 - margin.top - margin.bottom;

		// append the svg object to the body of the page
		var svg2 = d3
			.select("#groupedbarplot_div2")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr(
				"transform",
				"translate(" + margin.left + "," + margin.top + ")"
			);

		var x = d3.scaleLinear().domain([0, 10000]).range([0, width]);
		var xAxis = svg2
			.append("g")
			.attr("transform", "translate(0," + height + ")");

		// Y axis
		var y = d3.scaleBand().range([0, height]).padding(0.1);
		var yAxis = svg2.append("g").call(d3.axisLeft(y));

		let sortOrder = true;
		function update_bar_plot() {
			// Parse the Data
			d3.csv("files/capacidade_alojamentos.csv", function (data) {
				/* if (sortOrder != undefined) {
					data.sort((a, b) => {
						if (sortOrder) {
							return d3.ascending(
								parseInt(a[selectedVar]),
								parseInt(b[selectedVar])
							);
						} else {
							return d3.descending(
								parseInt(a[selectedVar]),
								parseInt(b[selectedVar])
							);
						}
					});
				} */

				// Update x axis
				x.domain([
					0,
					d3.max(data, function (d) {
						if (+d["2020"] > +d["2009"]) return +d["2020"];
						else return +d["2009"];
					}),
				]);

				xAxis
					.transition()
					.duration(1000)
					.call(d3.axisBottom(x))
					.selectAll("text")
					.style("text-anchor", "end")
					.attr("dx", "-.8em")
					.attr("dy", ".15em")
					.attr("transform", "rotate(-65)");

				// Update y axis
				y.domain(
					data.map(function (d) {
						return d.group;
					})
				);
				yAxis.transition().duration(1000).call(d3.axisLeft(y));

				var subgroups = data.columns.slice(1);

				// Another scale for subgroup position?
				var xSubgroup = d3
					.scaleBand()
					.domain(subgroups)
					//.range([0, x.bandwidth()])
					.range([0, 10000])
					.padding([0.05]);

				// color palette = one color per subgroup
				var color = d3
					.scaleOrdinal()
					.domain(subgroups)
					.range(["#e41a1c", "#377eb8"]);

				//  updateBarPlot bars
				var u = svg2
					.selectAll("g")
					.data(data)
					.enter()
					.append("g")
					.attr("transform", function (d) {
						return "translate(" + x(d.group) + ",0)";
					})
					.selectAll("rect")
					.merge(u)
					.data(function (d) {
						return subgroups.map(function (key) {
							return { key: key, value: d[key] };
						});
					})
					//.transition()
					.duration(1000)
					.attr("x", x(0) + 1)
					.attr("y", function (d) {
						return y(d.group);
					})
					.attr("width", function (d) {
						return x(d["2020"]);
					})
					.attr("height", y.bandwidth())
					.attr("fill", function (d) {
						console.log(d);
						return color(d);
					});

				/* // Show the bars
				svg2.append("g")
					.selectAll("g")
					// Enter in data = loop group per group
					.data(data)
					.enter()
					.append("g")
					.attr("transform", function (d) {
						return "translate(" + x(d.group) + ",0)";
					})
					.selectAll("rect")
					.data(function (d) {
						return subgroups.map(function (key) {
							return { key: key, value: d[key] };
						});
					})
					.enter()
					.append("rect")
					.attr("x", function (d) {xSubgroup
						return xSubgroup(d.key);
					})
					.attr("y", function (d) {
						return y(d.value);
					})
					.attr("width", xSubgroup.bandwidth())
					.attr("height", function (d) {
						return height - y(d.value);
					})
					.attr("fill", function (d) {
						return color(d.key);
					}); */
			});
		}

		//update_bar_plot();
	</script>
</html>
