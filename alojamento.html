<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
			crossorigin="anonymous"
		></script>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="alojamento.css" />
		<script src="https://d3js.org/d3.v4.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<div class="container-fluid">
				<a class="navbar-brand" href="index.html">Navbar</a>
				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarSupportedContent"
					aria-controls="navbarSupportedContent"
					aria-expanded="false"
					aria-label="Toggle navigation"
				>
					<span class="navbar-toggler-icon"></span>
				</button>
				<div
					class="collapse navbar-collapse"
					id="navbarSupportedContent"
				>
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item">
							<a
								class="nav-link"
								aria-current="page"
								href="/index.html"
								>Home</a
							>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="/alojamento.html"
								>Alojamento</a
							>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/receitas.html"
								>Receitas</a
							>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/despesas.html"
								>Despesas</a
							>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="container">
			<div class="title">
				<h1>População residente que viajou em turismo</h1>
			</div>
			<div class="subtitle">
				<h4>
					Onde há mais e menos pessoas a fazerem viagens turísticas,
					por faixas etárias?
				</h4>
			</div>
		</div>

		<div class="container graph">
			<div class="row filters">
				<div class="col-md-4">
					<select
						class="form-select"
						aria-label="Seleciona o ano"
						id="year-select"
					>
						<option selected value="2020" onclick="onSelect()">
							2020
						</option>
						<option value="2019" onclick="onSelect()">2019</option>
						<option value="2018">2018</option>
					</select>
				</div>
				<div class="col-md-4">
					<select
						class="form-select"
						aria-label="Seleciona a regiao"
						id="region-select"
					>
						<option
							value="files/viagens_grupo_etario_portugal.csv"
							selected
							onclick="onSelect()"
						>
							Portugal
						</option>
						<option
							value="files/viagens_grupo_etario_norte.csv"
							onclick="onSelect()"
						>
							Norte
						</option>
						<option value="Centro">Centro</option>
						<option value="Area">Area...</option>
					</select>
				</div>
				<div class="col-md-4">
					<button id="sort_button" class="btn btn-primary">
						Ordenar
					</button>
				</div>
			</div>

			<!-- Create a div where the graph will take place -->
			<div id="my_dataviz"></div>
		</div>
	</body>
	<script>
		// set the dimensions and margins of the graph
		var margin = { top: 30, right: 30, bottom: 70, left: 60 },
			width = 460 - margin.left - margin.right,
			height = 400 - margin.top - margin.bottom;

		// append the svg object to the body of the page
		var svg = d3
			.select("#my_dataviz")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr(
				"transform",
				"translate(" + margin.left + "," + margin.top + ")"
			);

		// Initialize the X axis
		var x = d3.scaleBand().range([0, width]);
		var xAxis = svg
			.append("g")
			.attr("transform", "translate(0," + height + ")");

		// Initialize the Y axis
		var y = d3.scaleLinear().range([height, 0]);
		var yAxis = svg.append("g").attr("class", "myYaxis");

		let sortOrder = false;

		// A function that create / update the plot for a given variable:
		function update(selectedVar, filename, sortOrder) {
			console.log("UPDATE: ", selectedVar, filename, sortOrder);
			// Parse the Data
			d3.csv(filename, function (data) {
				if (sortOrder != undefined) {
					data.sort((a, b) => {
						if (sortOrder) {
							return d3.ascending(a[selectedVar], b[selectedVar]);
						} else {
							return d3.descending(
								a[selectedVar],
								b[selectedVar]
							);
						}
					});
				}

				// X axis
				x.domain(
					data.map(function (d) {
						return d.group;
					})
				);
				xAxis.transition().duration(1000).call(d3.axisBottom(x));

				// Add Y axis
				y.domain([
					0,
					d3.max(data, function (d) {
						return +d[selectedVar];
					}),
				]);
				yAxis.transition().duration(1000).call(d3.axisLeft(y));

				// variable u: map data to existing bars
				var u = svg.selectAll("rect").data(data);

				// update bars
				u.enter()
					.append("rect")
					.merge(u)
					.transition()
					.duration(1000)
					.attr("x", function (d) {
						return x(d.group);
					})
					.attr("y", function (d) {
						return y(d[selectedVar]);
					})
					.attr("width", x.bandwidth())
					.attr("height", function (d) {
						return height - y(d[selectedVar]);
					})
					.attr("fill", "#69b3a2");
			});
		}

		d3.select("#sort_button").on("click", function (e, d) {});

		function onSelect(filename) {
			var year = document.getElementById("year-select").value;
			var region = document.getElementById("region-select").value;
			update(year, region, undefined);
		}

		// Initialize plot
		update("2020", "files/viagens_grupo_etario_portugal.csv", undefined);
	</script>
</html>
